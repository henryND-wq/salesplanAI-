<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neoderm 200% éŠ·å”®è¨ˆåŠƒ</title>
    <!-- Tailwind CSS for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX compilation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        :root {
            --bg-color: #05030a;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-color); 
            color: white;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            margin: 0;
        }

        /* Social Network Background Pattern */
        .bg-network {
            background-image: 
                radial-gradient(circle at center, transparent 0%, var(--bg-color) 100%),
                url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 20 L40 0 M20 20 L0 0 M20 20 L20 40 M20 20 L40 40 M20 20 L0 40' stroke='rgba(168, 85, 247, 0.08)' stroke-width='1'/%3E%3Ccircle cx='20' cy='20' r='1.5' fill='rgba(217, 70, 239, 0.3)'/%3E%3C/svg%3E");
            background-size: 60px 60px;
        }

        /* Hide number input spinners */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='rgba(255,255,255,0.4)'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.2em;
        }
    </style>
</head>
<body>
    <!-- é˜²æ­¢ React å´©æ½°æ™‚çš„ç™½å±å‚™ç”¨ç•«é¢ -->
    <div id="fallback-error" style="display: none; padding: 40px; text-align: center; color: #ef4444; font-weight: bold; font-size: 20px;">
        ç¶²é è…³æœ¬ç™¼ç”Ÿåš´é‡éŒ¯èª¤ï¼Œç„¡æ³•å•Ÿå‹• Reactã€‚è«‹æª¢æŸ¥ç€è¦½å™¨ä¸»æ§å° (F12)ã€‚
    </div>
    
    <div id="root">
        <div style="padding: 40px; text-align: center; color: #a855f7; font-weight: bold; font-size: 20px; animation: pulse 2s infinite;">
            ç³»çµ±ä»‹é¢è¼‰å…¥ä¸­... 
            <br><span style="font-size: 14px; color: #666;">(è‹¥åœç•™è¶…é 5 ç§’ï¼Œä»£è¡¨ä»£ç¢¼ç™¼ç”ŸéŒ¯èª¤)</span>
        </div>
    </div>

    <script type="text/babel">
        // æ””æˆªé‡å¤§éŒ¯èª¤
        window.addEventListener('error', () => {
            const fallback = document.getElementById('fallback-error');
            if(fallback) fallback.style.display = 'block';
        });

        const { useState, useEffect, useMemo, useCallback, useRef } = React;
        
        // ä¿®æ­£ç‰ˆå®‰å…¨ Icon å…ƒä»¶ï¼šä½¿ç”¨åŸç”Ÿ Lucide APIï¼Œ100% é˜²æ­¢å´©æ½°
        const Icon = ({ name, className = "", size = 24 }) => {
            const spanRef = useRef(null);
            useEffect(() => {
                if (spanRef.current && window.lucide && window.lucide.icons[name]) {
                    try {
                        spanRef.current.innerHTML = ''; 
                        const svg = window.lucide.createElement(window.lucide.icons[name]);
                        svg.setAttribute('width', size);
                        svg.setAttribute('height', size);
                        if (className) svg.setAttribute('class', className);
                        spanRef.current.appendChild(svg);
                    } catch (e) {
                        console.error("åœ–ç¤ºè¼‰å…¥å¤±æ•—:", e);
                    }
                }
            }, [name, size, className]);

            return <span ref={spanRef} className="inline-flex items-center justify-center" style={{ width: size, height: size }}></span>;
        };

        const formatHKD = (val) => new Intl.NumberFormat('zh-HK', { style: 'currency', currency: 'HKD', maximumFractionDigits: 0 }).format(val);

        const SignInput = ({ id, label, colorClass, iconName, planning, onUpdate }) => {
            const item = planning[id];
            const subtotal = Number(item.signs || 0) * Number(item.ticket || 0);

            return (
                <div className="relative group p-5 md:p-6 glass-panel rounded-3xl transition-all duration-300 hover:border-violet-500/30">
                    <div className="flex items-center gap-3 mb-5">
                        <div className={`p-2.5 rounded-xl bg-gradient-to-br ${colorClass} bg-opacity-10 shadow-lg`}>
                            <Icon name={iconName} size={22} className="text-white" />
                        </div>
                        <span className="text-base md:text-lg font-bold text-white/90 tracking-wide">{label}</span>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-2">
                            <label className="text-[11px] md:text-xs text-white/40 font-bold uppercase ml-1 tracking-widest">ç°½å–®ç›®æ¨™</label>
                            <input 
                                type="number" 
                                inputMode="numeric"
                                value={item.signs}
                                onChange={(e) => onUpdate(id, 'signs', e.target.value)}
                                className="w-full bg-black/40 border border-white/5 rounded-xl px-4 py-4 text-xl text-white font-mono focus:ring-1 focus:ring-violet-400 outline-none transition-all"
                                placeholder="0"
                            />
                        </div>
                        <div className="space-y-2">
                            <label className="text-[11px] md:text-xs text-white/40 font-bold uppercase ml-1 tracking-widest">å¹³å‡å®¢å–®åƒ¹</label>
                            <input 
                                type="number" 
                                inputMode="numeric"
                                value={item.ticket}
                                onChange={(e) => onUpdate(id, 'ticket', e.target.value)}
                                className="w-full bg-black/40 border border-white/5 rounded-xl px-4 py-4 text-xl text-white font-mono focus:ring-1 focus:ring-violet-400 outline-none transition-all"
                                placeholder="0"
                            />
                        </div>
                    </div>
                    <div className="mt-5 flex justify-between items-center px-1">
                        <span className="text-xs text-white/30 font-bold uppercase">åˆ†æ”¯å°è¨ˆ</span>
                        <span className="text-base md:text-xl font-black text-white/80">{formatHKD(subtotal)}</span>
                    </div>
                </div>
            );
        };

        // âš ï¸ è«‹ç¢ºä¿é€™æ˜¯æ‚¨æœ€æ–°çš„ Google Apps Script ç¶²å€
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwP0O0BsCWK0MN03uayShGS8-WWHBgPRZWz9LCTEiF4amChe2PoBVQYKOm_v_cmKqF7XQ/exec";

        const App = () => {
            const [db, setDb] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            
            const [filters, setFilters] = useState({ region: "HK", brand: "", center: "", therapist: "" });
            
            const [planning, setPlanning] = useState({
                upsell: { signs: 0, ticket: 6000 },
                birthday: { signs: 0, ticket: 4500 },
                tail: { signs: 0, ticket: 8000 },
                icb: { signs: 0, ticket: 12000 },
            });

            const [isSubmitting, setIsSubmitting] = useState(false);
            const [submitStatus, setSubmitStatus] = useState(null); 

            useEffect(() => {
                fetchData();
            }, []);

            const fetchData = async () => {
                setIsLoading(true);
                setError(null);
                try {
                    // è‡ªå‹•è¨ºæ–·ç³»çµ±
                    const response = await fetch(SCRIPT_URL);
                    const textData = await response.text();
                    
                    if (textData.trim().startsWith('<')) {
                        throw new Error("âŒ é€£ç·šè¢« Google æ””æˆª (CORS éŒ¯èª¤)ã€‚\né€™ä»£è¡¨æ‚¨å¾Œç«¯çš„ App Script éƒ¨ç½²è¨­å®šéŒ¯èª¤ï¼\nè§£æ±ºæ–¹æ³•ï¼šè«‹å›åˆ° Apps Scriptï¼Œé»æ“Šã€Œç®¡ç†éƒ¨ç½²ä½œæ¥­ã€ï¼Œç¢ºå®šã€Œå­˜å–æ¬Šã€è¨­ç‚ºã€æ‰€æœ‰äºº (Anyone)ã€‘ï¼Œç„¶å¾Œã€å»ºç«‹æ–°ç‰ˆæœ¬ã€‘ã€‚");
                    }
                    
                    let data;
                    try {
                        data = JSON.parse(textData);
                    } catch (parseError) {
                        throw new Error(`âŒ ç„¡æ³•è§£æ Google å›å‚³çš„è³‡æ–™ã€‚\nè©³ç´°è³‡æ–™: ${textData.substring(0, 100)}...`);
                    }
                    
                    if (!Array.isArray(data)) {
                        throw new Error("âŒ æ•¸æ“šæ ¼å¼éŒ¯èª¤ï¼šå›å‚³çš„ä¸æ˜¯é™£åˆ—ï¼Œè«‹æª¢æŸ¥è©¦ç®—è¡¨å…§å®¹ã€‚");
                    }

                    // è¨ºæ–· 1: å®Œå…¨æ²’æ”¶åˆ°è³‡æ–™ (å¯èƒ½æ˜¯èˆŠç‰ˆç¨‹å¼ç¢¼è®€å–äº†ç©ºçš„ Submissions)
                    if (data.length === 0) {
                        throw new Error("âš ï¸ æˆåŠŸé€£ç·šï¼Œä½†æ²’æœ‰è®€å–åˆ°ä»»ä½•è³‡æ–™ (0ç­†)ã€‚\nåŸå› åˆ†æï¼š\n1. æ‚¨æ˜¯å¦å°‡ Code.gs çš„ä»£ç¢¼æ”¹æˆäº†æœ€æ–°ç‰ˆä¸¦ã€éƒ¨ç½²äº†æ–°ç‰ˆæœ¬ã€‘ï¼Ÿ\n2. æ‚¨çš„ Google Sheet è£¡é¢æ˜¯å¦æœ‰å»ºç«‹ã€Databaseã€‘å·¥ä½œè¡¨ï¼Ÿ\n3. å·¥ä½œè¡¨è£¡é¢æ˜¯å¦æœ‰å¡«å¯«å“¡å·¥è³‡æ–™ï¼Ÿ");
                    }

                    // è¨ºæ–· 2: å¾Œç«¯å›å‚³äº†è‡ªå®šç¾©éŒ¯èª¤
                    if (data.length > 0 && data[0].Region === "âš ï¸ éŒ¯èª¤") {
                        throw new Error(`âŒ å¾Œç«¯ Google Sheet ç™¼ç”ŸéŒ¯èª¤ï¼š\n${data[0].Therapist}`);
                    }

                    // è¨ºæ–· 3: è®€å–åˆ°äº†éŒ¯èª¤çš„åˆ†é  (Submissions)
                    const firstRow = data[0];
                    if ('Timestamp' in firstRow && !('Therapist' in firstRow)) {
                         throw new Error("âŒ åš´é‡éŒ¯èª¤ï¼šæ‚¨æ­£åœ¨è®€å–ã€ŒSubmissions (æäº¤ç´€éŒ„)ã€å·¥ä½œè¡¨ï¼\nä¸‹æ‹‰é¸å–®æœƒå› æ­¤è®Šæˆç©ºç™½ã€‚\nè§£æ±ºæ–¹æ³•ï¼šè«‹å°‡ Code.gs è£¡ doGet() ä¸­è®€å–çš„åç¨±æ”¹ç‚ºæ‚¨å­˜æ”¾åå–®çš„åç¨± (å¦‚ Database)ï¼Œä¸¦é‡æ–°éƒ¨ç½²ã€‚");
                    }

                    setDb(data);
                } catch (err) {
                    console.error("Fetch Error:", err);
                    setError(err.message);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleUpdate = useCallback((id, field, value) => {
                setPlanning(prev => ({
                    ...prev,
                    [id]: {
                        ...prev[id],
                        [field]: value
                    }
                }));
            }, []);

            const availableRegions = useMemo(() => {
                const regions = [...new Set(db.map(i => i.Region))].filter(Boolean).sort();
                return regions.length > 0 ? regions : ["HK", "SH"];
            }, [db]);

            const brands = useMemo(() => {
                return [...new Set(db.filter(i => !filters.region || i.Region === filters.region).map(i => i.Brand))].filter(Boolean).sort();
            }, [db, filters.region]);

            const centers = useMemo(() => {
                return [...new Set(db.filter(i => 
                    (!filters.region || i.Region === filters.region) && 
                    (!filters.brand || i.Brand === filters.brand)
                ).map(i => i.Center))].filter(Boolean).sort();
            }, [db, filters.region, filters.brand]);

            const therapists = useMemo(() => {
                return db.filter(i => 
                    (!filters.region || i.Region === filters.region) && 
                    (!filters.brand || i.Brand === filters.brand) && 
                    (!filters.center || i.Center === filters.center)
                ).sort((a,b) => (a.Therapist || '').localeCompare(b.Therapist || ''));
            }, [db, filters.region, filters.brand, filters.center]);

            const selectedStaff = useMemo(() => db.find(i => i.Therapist === filters.therapist), [db, filters.therapist]);

            const calcSales = (key) => Number(planning[key].signs || 0) * Number(planning[key].ticket || 0);
            const existingSales = calcSales('upsell') + calcSales('birthday');
            const newSales = calcSales('tail') + calcSales('icb');
            const totalPlannedGrowth = existingSales + newSales;
            const mtdActual = selectedStaff ? Number(selectedStaff["Actual Sales (MTD)"] || 0) : 0;
            const originalTarget = selectedStaff ? Number(selectedStaff["Target Sales (Full Month)"] || 0) : 0;
            const superTarget = originalTarget * 2;
            const isTargetAchieved = selectedStaff && superTarget > 0 && totalPlannedGrowth >= superTarget;
            const displayMtdPct = selectedStaff ? (Number(selectedStaff["MTD%"] || 0) * 100).toFixed(1) : "0";

            const handleSubmit = async () => {
                if (!selectedStaff || isSubmitting) return;
                
                setIsSubmitting(true);
                setSubmitStatus(null);
                setError(null); // æ¸…é™¤éå»çš„éŒ¯èª¤

                const payload = {
                    region: selectedStaff.Region || filters.region,
                    therapist: selectedStaff.Therapist,
                    brand: selectedStaff.Brand,
                    center: selectedStaff.Center,
                    upsell_signs: planning.upsell.signs,
                    upsell_ticket: planning.upsell.ticket,
                    birthday_signs: planning.birthday.signs,
                    birthday_ticket: planning.birthday.ticket,
                    tail_signs: planning.tail.signs,
                    tail_ticket: planning.tail.ticket,
                    icb_signs: planning.icb.signs,
                    icb_ticket: planning.icb.ticket,
                    projected_total: totalPlannedGrowth,
                    timestamp: new Date().toLocaleString('zh-HK', { timeZone: 'Asia/Hong_Kong' })
                };

                try {
                    // ğŸŒŸ é—œéµä¿®å¾©ï¼šç§»é™¤äº† mode: 'no-cors'ï¼Œè®“ React èƒ½å¤ è®€å–åˆ° Google æ‹‹å›ä¾†çš„çœŸå¯¦å ±éŒ¯
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8',
                        },
                        body: JSON.stringify(payload)
                    });
                    
                    const textData = await response.text();
                    let result;
                    try {
                        result = JSON.parse(textData);
                    } catch (e) {
                        console.error("Raw response:", textData);
                        throw new Error("ä¼ºæœå™¨å›å‚³äº†éŒ¯èª¤ç•«é¢ã€‚\né€™ä»£è¡¨æ‚¨çš„ Google Apps Script åŸ·è¡Œå¤±æ•—ã€‚è«‹ç¢ºèªæ˜¯å¦å·²é»æ“Šã€ç®¡ç†éƒ¨ç½²ä½œæ¥­ã€‘->ã€å»ºç«‹æ–°ç‰ˆæœ¬ã€‘ã€‚");
                    }

                    if (result.status === 'error') {
                        throw new Error(`Google Apps Script å…§éƒ¨å‡ºéŒ¯: ${result.message}`);
                    }
                    
                    setSubmitStatus('success');
                    setTimeout(() => setSubmitStatus(null), 5000);
                } catch (error) {
                    console.error("Submit Error:", error);
                    setError(`âš ï¸ æäº¤å¯«å…¥å¤±æ•—ï¼š${error.message}`);
                    setSubmitStatus('error');
                    // è‡ªå‹•æ»¾å‹•åˆ°æœ€ä¸Šæ–¹è®“æ‚¨èƒ½çœ‹è¦‹å…·é«”çš„ç´…è‰²éŒ¯èª¤æç¤º
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    setTimeout(() => setSubmitStatus(null), 5000);
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <div className="min-h-screen relative">
                    <div className="fixed inset-0 pointer-events-none -z-10 bg-network"></div>
                    <div className="fixed inset-0 pointer-events-none -z-10">
                        <div className="absolute top-[-10%] left-[-5%] w-[70%] h-[50%] bg-violet-600/15 blur-[120px] rounded-full"></div>
                        <div className="absolute bottom-[-10%] right-[-5%] w-[70%] h-[50%] bg-fuchsia-600/15 blur-[120px] rounded-full"></div>
                    </div>

                    {isLoading && (
                        <div className="fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex flex-col items-center justify-center">
                            <Icon name="Network" className="w-12 h-12 text-violet-400 animate-spin mb-4" size={48} />
                            <p className="text-violet-400 font-bold tracking-[0.5em] text-lg animate-pulse">ç¯€é»æ•¸æ“šåŒæ­¥ä¸­...</p>
                        </div>
                    )}

                    <div className="relative z-10 max-w-7xl mx-auto px-4 py-8 md:px-10 md:py-16">
                        <header className="flex flex-col gap-8 mb-12 md:mb-16">
                            <div className="text-center md:text-left flex flex-col md:flex-row justify-between items-center gap-6">
                                <div>
                                    <div className="flex items-center gap-3 mb-4 justify-center md:justify-start">
                                        <Icon name="Share2" size={16} className="text-violet-400" />
                                        <span className="text-xs font-black text-violet-400 uppercase tracking-[0.5em]">v4.0 Social Network Ecosystem</span>
                                    </div>
                                    <h1 className="text-4xl md:text-5xl lg:text-6xl font-black tracking-tighter italic leading-tight drop-shadow-lg">
                                        Neoderm <span className="text-transparent bg-clip-text bg-gradient-to-r from-violet-400 via-fuchsia-400 to-pink-400">200% éŠ·å”®è¨ˆåŠƒ</span>
                                    </h1>
                                </div>

                                <div className="inline-flex bg-white/[0.03] border border-white/10 rounded-full p-1.5 backdrop-blur-xl shrink-0">
                                    {availableRegions.map(region => (
                                        <button
                                            key={region}
                                            onClick={() => setFilters({ region, brand: "", center: "", therapist: "" })}
                                            className={`px-8 py-3 rounded-full text-sm font-black tracking-[0.2em] uppercase transition-all duration-300 ${
                                                filters.region === region 
                                                ? 'bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white shadow-[0_0_20px_rgba(168,85,247,0.4)]' 
                                                : 'text-white/40 hover:text-white/80'
                                            }`}
                                        >
                                            {region}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 p-3 glass-panel rounded-2xl md:rounded-[3rem] border border-violet-500/10 relative">
                                {['brand', 'center', 'therapist'].map((key) => (
                                    <div key={key} className="relative w-full">
                                        <select 
                                            value={filters[key]}
                                            onChange={(e) => {
                                                const val = e.target.value;
                                                if (key === 'brand') setFilters({ ...filters, brand: val, center: "", therapist: "" });
                                                else if (key === 'center') setFilters({ ...filters, center: val, therapist: "" });
                                                else setFilters({ ...filters, [key]: val });
                                            }}
                                            className="w-full bg-black/60 border border-white/5 rounded-xl md:rounded-[2.5rem] px-6 py-4 text-base md:text-lg font-bold text-white outline-none cursor-pointer hover:bg-violet-900/30 transition-colors"
                                        >
                                            <option value="">é¸æ“‡{key === 'brand' ? 'å“ç‰Œ' : key === 'center' ? 'ç¶²çµ¡ä¸­å¿ƒ' : 'æ²»ç™‚å¸« (ç¯€é»)'}</option>
                                            {(key === 'brand' ? brands : key === 'center' ? centers : therapists.map(t => t.Therapist)).map(opt => <option key={opt} value={opt}>{opt}</option>)}
                                        </select>
                                    </div>
                                ))}
                                
                                {db.length > 0 && brands.length === 0 && (
                                     <div className="absolute inset-0 bg-black/80 flex items-center justify-center rounded-[3rem] text-orange-400 font-bold backdrop-blur-md">
                                        âš ï¸ è³‡æ–™å·²é€£æ¥ï¼Œä½†æ‰¾ä¸åˆ°ã€Œå“ç‰Œã€ç­‰æ¬„ä½ï¼Œè«‹æª¢æŸ¥ Google Sheet æ¨™é¡Œæ˜¯å¦æ­£ç¢ºã€‚
                                     </div>
                                )}
                            </div>
                            
                            {error && (
                                <div className="p-6 bg-red-500/10 border-2 border-red-500/40 rounded-3xl flex items-start gap-4 text-red-400 text-base animate-in slide-in-from-top-2 shadow-2xl">
                                    <Icon name="AlertCircle" size={28} className="w-8 h-8 flex-shrink-0 mt-0.5" />
                                    <pre className="whitespace-pre-wrap font-sans leading-relaxed text-lg">{error}</pre>
                                </div>
                            )}
                        </header>

                        {selectedStaff ? (
                            <div className="animate-in fade-in duration-700">
                                <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8 mb-12 md:mb-20">
                                    {[
                                        { label: 'MTD å¯¦éš›éŠ·å”®', value: formatHKD(mtdActual), icon: 'DollarSign', color: 'text-white' },
                                        { label: 'ç•¶å‰é”æˆç‡', value: `${displayMtdPct}%`, icon: 'ShieldCheck', color: 'text-emerald-400' },
                                        { label: 'ACB ç¶²çµ¡åŸºæ•¸', value: selectedStaff["ACB (Curr. Month End)"], icon: 'Users', color: 'text-violet-400' },
                                        { label: 'ICB ç¶²çµ¡åŸºæ•¸', value: selectedStaff["ICB (Curr. Month End)"], icon: 'Network', color: 'text-fuchsia-400' }
                                    ].map((m, i) => (
                                        <div key={i} className="p-6 md:p-8 glass-panel rounded-3xl md:rounded-[2.5rem] relative overflow-hidden group hover:border-violet-500/30 transition-all">
                                            <div className="absolute inset-0 bg-gradient-to-br from-violet-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                            <div className="flex items-center gap-3 mb-2 relative z-10">
                                                <Icon name={m.icon} size={18} className="text-white/20" />
                                                <span className="text-xs md:text-sm text-white/40 font-bold uppercase tracking-widest">{m.label}</span>
                                            </div>
                                            <div className={`text-xl md:text-3xl font-black relative z-10 ${m.color}`}>{m.value}</div>
                                        </div>
                                    ))}
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-10 md:gap-16 mb-16 md:mb-24">
                                    <section className="space-y-8">
                                        <div className="flex items-center gap-4 px-2">
                                            <div className="h-6 w-1.5 bg-violet-500 rounded-full shadow-[0_0_10px_rgba(139,92,246,0.8)]"></div>
                                            <h2 className="text-3xl font-black italic tracking-tight flex items-center gap-3">
                                                å…§éƒ¨è½‰åŒ– <span className="text-sm font-medium text-violet-400 uppercase tracking-widest not-italic">Existing Pillar</span>
                                            </h2>
                                        </div>
                                        <SignInput id="upsell" label="è¿½åŠ ç°½å–® (UP-SELL)" colorClass="from-violet-500 to-violet-400" iconName="GitMerge" planning={planning} onUpdate={handleUpdate} />
                                        <SignInput id="birthday" label="ç”Ÿæ—¥ç°½å–® (BIRTHDAY)" colorClass="from-violet-400 to-violet-300" iconName="Gift" planning={planning} onUpdate={handleUpdate} />
                                        <div className="px-6 py-2 text-right">
                                            <span className="text-xs text-white/30 font-bold uppercase mr-4 tracking-widest">å…§éƒ¨ç¶²çµ¡å¢é•·é¡</span>
                                            <span className="text-2xl font-black text-violet-400 font-mono">{formatHKD(existingSales)}</span>
                                        </div>
                                    </section>
                                    
                                    <section className="space-y-8">
                                        <div className="flex items-center gap-4 px-2">
                                            <div className="h-6 w-1.5 bg-fuchsia-500 rounded-full shadow-[0_0_10px_rgba(217,70,239,0.8)]"></div>
                                            <h2 className="text-3xl font-black italic tracking-tight flex items-center gap-3">
                                                å¤–éƒ¨è£‚è®Š <span className="text-sm font-medium text-fuchsia-400 uppercase tracking-widest not-italic">New Pillar</span>
                                            </h2>
                                        </div>

                                        <div className="p-8 glass-panel rounded-3xl border border-fuchsia-500/20 bg-fuchsia-500/[0.03]">
                                            <div className="flex items-center gap-3 mb-6">
                                                <Icon name="Globe" size={24} className="text-fuchsia-400" />
                                                <span className="text-base md:text-lg font-black text-fuchsia-400 uppercase tracking-widest">å®¢äººé–‹åº—æ»²é€ç‡</span>
                                            </div>
                                            <div className="grid grid-cols-2 gap-8">
                                                <div>
                                                    <span className="text-sm md:text-base text-white/50 font-bold uppercase block mb-2 tracking-widest">ACB ç¶²åº—é€£ç·šæ•¸</span>
                                                    <span className="text-4xl md:text-5xl font-black text-white">{selectedStaff["ACB Shop Count"] || 0}</span>
                                                    <div className="text-base md:text-lg font-black text-fuchsia-300 mt-2 tracking-wider">
                                                        æ»²é€ç‡: {Number(selectedStaff["ACB (Curr. Month End)"]) > 0 ? ((Number(selectedStaff["ACB Shop Count"]) / Number(selectedStaff["ACB (Curr. Month End)"])) * 100).toFixed(1) : "0"}%
                                                    </div>
                                                </div>
                                                <div>
                                                    <span className="text-sm md:text-base text-white/50 font-bold uppercase block mb-2 tracking-widest">ICB ç¶²åº—é€£ç·šæ•¸</span>
                                                    <span className="text-4xl md:text-5xl font-black text-white">{selectedStaff["ICB Shop Count"] || 0}</span>
                                                    <div className="text-base md:text-lg font-black text-fuchsia-300 mt-2 tracking-wider">
                                                        æ»²é€ç‡: {Number(selectedStaff["ICB (Curr. Month End)"]) > 0 ? ((Number(selectedStaff["ICB Shop Count"]) / Number(selectedStaff["ICB (Curr. Month End)"])) * 100).toFixed(1) : "0"}%
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <SignInput id="tail" label="é¾å°¾ (TAIL)" colorClass="from-fuchsia-500 to-fuchsia-400" iconName="Activity" planning={planning} onUpdate={handleUpdate} />
                                        <SignInput id="icb" label="ICB ç°½å–® (ICB SIGN)" colorClass="from-fuchsia-400 to-pink-400" iconName="Zap" planning={planning} onUpdate={handleUpdate} />
                                        <div className="px-6 py-2 text-right">
                                            <span className="text-xs text-white/30 font-bold uppercase mr-4 tracking-widest">å¤–éƒ¨ç¶²çµ¡å¢é•·é¡</span>
                                            <span className="text-2xl font-black text-fuchsia-400 font-mono">{formatHKD(newSales)}</span>
                                        </div>
                                    </section>
                                </div>

                                <div className="relative group rounded-[3rem] md:rounded-[4rem] overflow-hidden mb-16 shadow-2xl">
                                    <div className="absolute inset-0 bg-gradient-to-br from-white/[0.05] to-transparent pointer-events-none"></div>
                                    <div className="glass-panel p-8 md:p-16 relative">
                                        <div className="absolute top-0 right-8 md:right-16 bg-gradient-to-r from-orange-500 to-red-600 px-6 py-2 rounded-b-2xl flex items-center gap-2 shadow-xl">
                                            <Icon name="Flame" size={16} className="text-white" />
                                            <span className="text-xs font-black uppercase tracking-tighter">200% Super Target</span>
                                        </div>

                                        <div className="flex flex-col xl:flex-row items-center gap-10 xl:gap-16 mt-4 md:mt-0">
                                            <div className="flex-1 w-full min-w-0 text-center xl:text-left">
                                                <span className="text-xs text-white/30 font-black uppercase tracking-[0.5em] block mb-6">é ä¼°è¦åŠƒç¸½å¢é•·é¡ (P1+P2)</span>
                                                <div className="text-6xl sm:text-7xl md:text-8xl lg:text-[5rem] xl:text-[5.5rem] font-black text-white leading-none mb-10 tracking-tighter tabular-nums drop-shadow-2xl break-words">
                                                    {formatHKD(totalPlannedGrowth)}
                                                </div>
                                                
                                                <div className="flex flex-col sm:flex-row gap-4 justify-center xl:justify-start">
                                                    <div className="px-8 py-5 bg-orange-500/10 rounded-2xl border border-orange-500/10 flex-1 max-w-[300px] backdrop-blur-xl">
                                                        <span className="text-xs text-orange-400 block mb-2 font-bold uppercase tracking-widest">200% ç›®æ¨™é¡</span>
                                                        <span className="text-2xl font-black text-orange-400 truncate block">{formatHKD(superTarget)}</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="flex flex-col gap-8 items-center xl:items-end w-full xl:w-auto xl:min-w-[340px] flex-shrink-0">
                                                <div className="text-center xl:text-right">
                                                    <div className="text-7xl md:text-8xl lg:text-[5.5rem] font-black text-white mb-3 tabular-nums tracking-tighter leading-none">
                                                        {originalTarget > 0 ? ((totalPlannedGrowth / originalTarget) * 100).toFixed(1) : 0}%
                                                    </div>
                                                    <div className="text-sm text-white/30 font-black uppercase tracking-[0.2em]">æ¨¡æ“¬é”æˆç‡ (å°æ¨™ 200%)</div>
                                                </div>

                                                <div className={`w-full py-6 px-10 rounded-3xl text-center text-lg font-black tracking-[0.2em] uppercase border transition-all duration-500 shadow-2xl ${isTargetAchieved ? 'bg-emerald-500 text-black border-emerald-400' : 'bg-white/5 text-white/40 border-white/10'}`}>
                                                    {!selectedStaff ? (
                                                        "è«‹å…ˆé¸æ“‡äººå“¡"
                                                    ) : isTargetAchieved ? (
                                                        <div className="flex items-center justify-center gap-3">
                                                            <Icon name="ShieldCheck" size={24} /> 200% ç›®æ¨™å·²é–å®š
                                                        </div>
                                                    ) : (
                                                        `å°šæ¬  ${formatHKD(Math.max(0, superTarget - totalPlannedGrowth))}`
                                                    )}
                                                </div>
                                            </div>
                                        </div>

                                        <div className="mt-16 h-4 w-full bg-white/5 rounded-full overflow-hidden p-1 border border-white/5 mb-10">
                                            <div 
                                                className="h-full bg-gradient-to-r from-cyan-500 via-blue-500 to-indigo-600 rounded-full transition-all duration-1000 ease-out relative" 
                                                style={{ width: `${selectedStaff && superTarget > 0 ? Math.min(100, (totalPlannedGrowth / superTarget) * 100) : 0}%` }}
                                            >
                                                <div className="absolute top-0 right-0 h-full w-8 bg-white/20 blur-md animate-pulse"></div>
                                            </div>
                                        </div>

                                        <div className="border-t border-white/10 pt-10 flex justify-center">
                                            <button 
                                                onClick={handleSubmit} 
                                                disabled={isSubmitting}
                                                className={`flex items-center justify-center gap-3 w-full md:w-auto px-12 py-5 rounded-full font-black text-xl tracking-[0.2em] uppercase transition-all duration-300 shadow-2xl ${
                                                    submitStatus === 'success' ? 'bg-emerald-500 text-black shadow-[0_0_30px_rgba(16,185,129,0.4)]' :
                                                    submitStatus === 'error' ? 'bg-red-500 text-white shadow-[0_0_30px_rgba(239,68,68,0.4)]' :
                                                    isSubmitting ? 'bg-white/10 text-white/50 cursor-not-allowed' :
                                                    'bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white hover:scale-105 shadow-[0_0_30px_rgba(168,85,247,0.5)] border border-fuchsia-500/30'
                                                }`}
                                            >
                                                {isSubmitting ? (
                                                    <><Icon name="RefreshCw" className="animate-spin text-white/50" size={24} /> ç¯€é»åŒæ­¥ä¸­...</>
                                                ) : submitStatus === 'success' ? (
                                                    <><Icon name="CheckCircle2" size={24} /> ç¶²çµ¡åŒæ­¥å®Œæˆ</>
                                                ) : submitStatus === 'error' ? (
                                                    <><Icon name="AlertCircle" size={24} /> é€£ç·šå¹²æ“¾ï¼Œè«‹é‡è©¦</>
                                                ) : (
                                                    <><Icon name="Share2" size={24} /> æäº¤å°ˆå±¬è¦åŠƒ (SYNC)</>
                                                )}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="glass-panel border-violet-500/20 p-20 rounded-[3rem] text-center space-y-6 animate-pulse mt-8">
                                <Icon name="Network" size={64} className="mx-auto text-violet-500/30" />
                                <p className="text-xl md:text-2xl text-violet-300/50 font-black uppercase tracking-[0.4em]">è«‹å…ˆåœ¨ä¸Šæ–¹é€£æ¥åœ°å€åŠæ²»ç™‚å¸«ç¯€é»</p>
                            </div>
                        )}
                        
                        <footer className="text-center pb-12 mt-20">
                            <span className="text-xs font-black uppercase tracking-[0.6em] text-violet-400/30">Neo Derm Social Strategy Hub &copy; 2024</span>
                        </footer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
